<!DOCTYPE html>
<html lang="en">

<head>
<script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kembali</title>        
  <link href="https://tdmshop.biz.id/bootstrap-5.3.2-dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  <style type="text/css">
    @import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css");

    * {
      font-family: 'Poppins', sans-serif;
      user-select: none;
    }
    body {
      background-color: #EDF1FC;
    }
    p {
      margin: 0;
      font-size: 16px
    }
    input {
      border: none;
      -webkit-transition: 0.5s;
      transition: 0.5s;
      outline: none;
    }
    a,
    a:focus,
    a:hover {
      text-decoration: none;
      color: inherit;
    }
    @-webkit-keyframes fadeEffect {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    @keyframes fadeEffect {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
.my-color {
color: #7E57C2;
}
    .borad-5 {
      border-radius: 5px
    }
    .my-shadow {
      box-shadow: rgba(0, 0, 0, 0.15) 0 0 5px 1px;
    }
    .bg-white {
      background-color: #fff !important
    }
    .f-11 {
      font-size: 11px !important
    }
    .f-12 {
      font-size: 12px !important
    }
    .f-14 {
      font-size: 14px !important
    }
    .f-18 {
      font-size: 18px !important
    }
    .f-20 {
      font-size: 20px !important
    }
    .f-24 {
      font-size: 24px !important
    }
    .f-28 {
      font-size: 28px !important
    }
    .fwb-5 {
      font-weight: 500 !important
    }
    .fwb-6 {
      font-weight: 600 !important
    }
    .fwb-7 {
      font-weight: 900 !important
    }
    .fwb-8 {
      font-size: 15px !important
    }
    .fwb-9 {
      font-size: 70% !important;
      font-weight: 900;
    }
    .fwb-10 {
      font-size: 66% !important;
      font-weight: 900;
    }
    .fwb-11 {
      font-size: 95% !important;
      font-weight: 900;
    }
    .ind {
      font-weight: 500;
      margin-right: 20px;
      opacity: 0.7;
      font-size: 14px
    }
    .codingasik-shield {
display: flex;
margin-top: 0px;
margin-bottom: -7px;
margin-left: 0px;

}

.shield {
width: 100%;
text-align: center;
}

.image-shield img {
width: 35px;
margin-left: 4px;
animation: gelatine 1s infinite;
}

.text-shield h5 {
font-size: 11px;
font-weight: 500;
color: black;
margin-left: 0px;
margin-bottom: 0px;
margin-top: 5px;
}
.header-codingasik {
position: fixed;
top: 0px;
width: 100%;
left: 0px;
display: flex;
z-index: 10;
}

.branding {
position: fixed;
top: 0;
left: 0;
width: 100%;
text-align: center;
z-index: 100;
padding-top: 3px;
background: #7E57C2;

}

.branding img {
width: 110px;
}

.codingasik-style {
width: 100%;
height: 40px;
border-radius: 0px 0px 100% 100%;
background: #7E57C2;
box-shadow: rgba(0, 0, 0, 0.18) 0px 2px 4px;
}
    .val {
      font-weight: 500;
      font-size: 14px
    }
    .text-purple {
      color: #6f42c1
    }
    .useless {
      font-size: 1px;
      background-color: transparent;
      color: #EDF1FC;
      z-index: 0;
      position: absolute;
      margin-top: -20px
    }
    .btn-konfirm {
      background-color: #7E57C2;
      padding: 5px;
      font-weight: 500;
      color: #fff;
      border-radius: 5px;
      margin-top: 8px;
      box-shadow: rgba(0, 0, 0, 0.15) 0 0 5px 1px;
      ;
      text-align: center;
      position: relative;
      z-index: 99
    }
    .list-trx {
      padding: 12px 0;
      border-bottom: 1px solid #ededed
    }
    .bg-pink {
      background-color: #FF6071
    }
    .dot {
      margin: 0;
      border-top: 2.5px dashed #cccccc;
      opacity: 0.5;
    }
    .header {
    background-image: url('https://img.freepik.com/free-vector/copy-space-wavy-white-background-layers_23-2148845469.jpg?w=2000')
    }
    .alertin {
      position: absolute;
      z-index: 99;
      width: 100%;
      height: 115%;
      background-color: #fff;
      padding: 8px;
      text-align: center;
    }
    .body-alert {
      text-align: center;
      padding: 40px 0;
      background: #EBF0F5;
    }
    .aler {
      background: white;
      padding: 40px;
      border-radius: 12px;
      display: inline-block;
      margin: 0 auto;
    }

    .aler img {
      height: 100%;
      width: 100%;
    }
 
.box{
padding: 20px;
background-color: white;
border-radius: 10px;
box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 3px 0px, rgba(0, 0, 0, 0.06) 0px 1px 2px 0px;
}
    	.logo-container11 {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .logo-qris11 {
      height: 35px;
      margin-right: 90px;
      margin-top: 1px;
      margin-bottom: 10px;
    }
    .logo-gpn11 {
      height: 35px;
      margin-left: 45px;
      margin-top: 1px;
      margin-bottom: 10px;
    }
  
  .box-11 {
    background: #f6f6f6;
          
    border-radius: 5px;
    padding: 15px;
   }
  
    .hj {
      border: 1px solid #f1f1f1;
      margin-top: 5px;
      margin-bottom: 5px;
        }
  
  </style>
</head>
<body onload="generateQRIS()">
<section class="p-3">
      <div class="box">
        <div class="text-center">
          			<div class="logo-container11">
  <img src="https://xendit.co/wp-content/uploads/2020/03/iconQris.png" alt="QRIS Logo" class="logo-qris11">
  <img src="https://upload.wikimedia.org/wikipedia/commons/8/83/Gerbang_Pembayaran_Nasional_logo.svg" alt="GPN Logo" class="logo-gpn11">
  </div>
    <hr class="dot">
       <p style="font-weight: bold; margin-top: 15px; color: white;font-size: 12px; border-radius: 20px; background-color: #7E57C2; padding: 4px 8px;display: inline-block;">Scan Qris Untuk Melakukan Pembayaran</p>
       <div id="qrcodeContainer" class="for-qris p-4 text-center"></div>
          <p style="font-weight: bold; margin-bottom: 15px; color: white;font-size: 13px; border-radius: 10px; background-color: #7E57C2; padding: 4px 8px;display: inline-block;">Klik Titik Tiga Di Pojok Kanan Atas Untuk Membatalkan Topup</p>
          <hr class="dot">
          <br>
          <div class="box-11">
           <div class="text-center">
           <h5><p class="fwb-7">Detail Pembayaran</p></h5>
          </div>   
          <div class="d-flex justify-content-between py-1">
            <p class="ind">ID Transaksi</p>
            <p class="val">{{id_transaksi}}</p>
          </div>
          <div class="d-flex justify-content-between py-1">
            <p class="ind">Total Bayar</p>
            <p class="val" id="val-1">{{total_bayar}}</p>
          </div>
            </div>
          <br>
          <hr class="dot">       
            <div class="bottom mt-3">
              <div class="button" style="background:white;margin-top:5px;">
                    <div class="btn btn-secondary" id="statusPembayaran"
                        style="background : transparent; font-size: 16px; color: #7E57C2; border: 1.5px solid #7E57C2; border-radius: 5px; font-weight: 500; padding:10px; width:100%;margin-bottom:10px;" onclick="konfirmasi('{{url_cek_status}}')"
                       
                                           </div></div>  
          <font color="ff0000">
         
         </font>
         </div>
        </div>
      </div>
    </div>
</div></div>
<input type="text" value="{{total_bayar}}" class="useless" id="total-bayar" style="margin-top: 30px">
</section>
  </section>
      </div>
    </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.3.min.js"
    integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="text/javascript">

    function copyIn() {
      var id = "total-bayar"
      document.getElementById(id).select();
      document.execCommand("copy");
      window.getSelection().removeAllRanges();
      Swal.fire({
        title: 'Yeay',
        text: "Berhasil Menyalin",
        icon: 'success',
        showConfirmButton: false,
        timer: 1000
      })
    }
    function goLink(link) {
      window.location.href = link
    }
    var countDownDate = new Date("{{token_expired}}").getTime();
    var x = setInterval(function () {
      var d = new Date()
      var log = d.toLocaleString('en-US', { timeZone: 'Asia/Jakarta' })
      var now = new Date(log).getTime();
      var distance = countDownDate - now;
      var days = Math.floor(distance / (1000 * 60 * 60 * 24));
      var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      var seconds = Math.floor((distance % (1000 * 60)) / 1000);
      document.getElementById("exp").innerHTML = minutes + " Menit " + seconds + " Detik";
      if (distance < 0) {
      clearInterval(x);
      document.getElementById("exp").innerHTML = "EXPIRED";
      // $("#alertz").removeClass("d-none")
      }
     }, 1000);

    function rubah(angka) {
      var reverse = angka.toString().split('').reverse().join(''),
        ribuan = reverse.match(/\d{1,3}/g);
      ribuan = ribuan.join('.').split('').reverse().join('');
      return "Rp" + ribuan;
    }
    document.getElementById("val-1").innerText= rubah(document.getElementById("val-1").textContent);
    document.getElementById("val-2").innerText= rubah(document.getElementById("val-2").textContent);
    document.getElementById("val-3").innerText= rubah(document.getElementById("val-3").textContent);
    document.getElementById("val-5").innerText= rubah(document.getElementById("val-5").textContent);

  </script>
<script>
        function generateQRIS() {
            var qrisData = "00020101021126670016COM.NOBUBANK.WWW01189360050300000879140214526464508596320303UMI51440014ID.CO.QRIS.WWW0215ID20232810994400303UMI5204481253033605802ID5923ACHMAD ALHADI OK12758686006BEKASI61051711162070703A016304C8C8";
            var paymentAmount = "{{total_bayar}}";
            var result = "";
            qrisData = qrisData.slice(0, -4);
            var step1 = qrisData.replace("010211", "010212");
            var step2 = step1.split("5802ID");
            var uang = "54" + ("0" + paymentAmount.length).slice(-2) + paymentAmount;
            uang += "5802ID";
            result = step2[0] + uang + step2[1] + convertCRC16(step2[0] + uang + step2[1]);
            var qrCode = new QRCodeStyling({
        width:250,
        height:250,
        type: "svg",
        data: result,
        image: "",
        dotsOptions: {
            color: "#00000",
            type: "rounded"
        },
        backgroundOptions: {
            color: "",
        },
        imageOptions: {
            crossOrigin: "anonymous",
            margin: 20
        }
    });
    qrCode.append(document.getElementById("qrcodeContainer"));
    qrCode.download({ name: "qr", extension: "svg" });
        }
        function convertCRC16(str) {
            var crc = 0xFFFF;
            var strlen = str.length;
            for (var c = 0; c < strlen; c++) {
                crc ^= str.charCodeAt(c) << 8;
                for (var i = 0; i < 8; i++) {
                    if (crc & 0x8000) {
                        crc = (crc << 1) ^ 0x1021;
                    } else {
                        crc = crc << 1;
                    }
                }
            }
            var hex = crc & 0xFFFF;
            hex = ("000" + hex.toString(16).toUpperCase()).slice(-4);
            return hex;
        }

</script>

<script>
  function checkPaymentStatus() {
    $.ajax({
      url: "{{url_cek_status}}",
      method: "GET",
      success: function(response) {
        document.getElementById("statusPembayaran").innerHTML = response; // Menampilkan respons HTML di elemen <div>

        // Periksa apakah pembayaran berhasil
        if (response.includes("Terimakasih")) {
          // Pembayaran berhasil, hentikan polling
          document.getElementById("statusPembayaran").innerHTML = "Berhasil, Silahkan Refresh Aplikasi"; // Menampilkan respons HTML di elemen <div>
          return;
        }
        else if (response.includes("Menunggu Pembayaran")) {
          // Pembayaran masih dalam proses, lanjutkan polling setelah 3 detik
          setTimeout(checkPaymentStatus, 3000); // Polling setiap 3 detik (3000 milidetik)
          document.getElementById("statusPembayaran").innerHTML = "Expired: {{token_expired}}"; // Menampilkan respons HTML di elemen <div>
        }
        else if (response.includes("Sesi pembayaran telah berakhir")) {
            document.getElementById("statusPembayaran").innerHTML = "Sesi telah berakhir, Klik Titik 3 Pojok Kanan Atas"; // Menampilkan respons HTML di elemen <div>
        }
      },
      error: function(error) {
        document.getElementById("statusPembayaran").innerText = "Terjadi kesalahan.";
      }
    });
  }

  $(document).ready(function() {
    checkPaymentStatus();
  });
</script>
</body>
</html>
